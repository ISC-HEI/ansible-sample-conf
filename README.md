<div align="center">

# Ansible Sample Conf - Lab Generator

This project allows you to dynamically generate an isolated testing laboratory using **Docker Compose** based on an **Ansible** inventory. It is ideal for validating playbooks (such as those in [ansible-playbooks](https://github.com/ISC-HEI/ansible-playbooks)) without affecting your local machine.

![Linux](https://img.shields.io/badge/Linux-FCC624?style=for-the-badge&logo=linux&logoColor=black)
![Ansible](https://img.shields.io/badge/Ansible-000000?style=for-the-badge&logo=ansible&logoColor=white)
![Docker](https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=docker&logoColor=white)
![Python](https://img.shields.io/badge/Python-3776AB?style=for-the-badge&logo=python&logoColor=white)
![Bash](https://img.shields.io/badge/Bash-4EAA25?style=for-the-badge&logo=gnu-bash&logoColor=white)
![License](https://img.shields.io/badge/License-Apache-red.svg?style=for-the-badge)

</div>

## Features

* **Infrastructure-as-Inventory**: The `docker-compose.yml` file is automatically generated by extracting hostnames and SSH ports from your Ansible inventory.
* **Systemd Containers**: Uses privileged mode to simulate real Linux servers with service management capabilities.
* **Automated Lifecycle**: Deploys the lab, executes tests (ping or full playbook), and performs a full cleanup after use.

## Prerequisites

* **Docker & Docker Compose**
* **Python 3**
* **Ansible**

## Getting Started
Clone the sample repository.
```bash
git clone https://github.com/ISC-HEI/ansible-sample-conf.git
cd ansible-sample-conf
```

If you want to have the playbooks, clone it too.
```bash
cd ..
git clone https://github.com/ISC-HEI/ansible-playbooks.git
```

## Usage

The main script is `test_lab.sh`.

### Syntax
```bash
./test_lab.sh -i <inventory_path> [-t <playbook_path>]
```

### Examples
**1. Run a connectivity test (Ping)**: Use this to verify that all containers are up and SSH is reachable.
```bash
./test_lab.sh -i inventory/inventory.yml
```
> **Note:** [inventory.yml](inventory/inventory.yml) is an example of configuration using a password instead of a public key, along with other configuration examples, you can add mailer too.

**2. Execute a specific playbook**: Use this to run your full configuration logic against the temporary lab.
```bash
./test_lab.sh -i inventory/inventory.yml -t ./path/to/test_today.yml
```

## Important Limitations

Since the containers share the host's **Kernel**, please keep the following in mind:
* **Missing System Packages**: Docker images are minimal. If your playbooks fail on tasks like setting timezones or managing specific services, you may need to install additional packages (e.g., `tzdata`, `systemd` (already in)) in the [Dockerfile](build/Dockerfile).
* **Kernel Modules**: Tasks using `modprobe` or trying to modify kernel parameters will likely fail (Normally, this will fail, but it will continue because it will be ignored.).
* **Network/Storage**: Advanced low-level operations (like partitioning disks or complex firewalling) may behave differently than on a physical bare-metal server.

---

For more details on the playbooks themselves, visit: [ISC-HEI/ansible-playbooks](https://github.com/ISC-HEI/ansible-playbooks/tree/main)